I"<p><br />
<strong>Room Database</strong>로부터 Livedata를 호출하는 일은 자주 발생한다. View(Activity 혹은 Fragment)에서 변경되는 데이터<br />
<strong>(i.e. DatePickerDialog에서 선택한 날짜, Spinner에서 선택한 값 등)</strong><br />
를 LiveData 호출하는 메서드의 매개변수로 전달하고 싶을 때가 있다.</p>

<p>이럴 때 View에서 ViewModel에 선언된 메서드로 직접 파라미터 값을 넘기는 방법</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">HistoryViewModel</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">(){</span>
    <span class="c1">// You shouldn't do like this</span>
    <span class="k">fun</span> <span class="nf">loadHistory</span><span class="p">(</span><span class="n">date</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">LiveData</span><span class="p">&lt;</span><span class="nc">History</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">mHistoryDAO</span><span class="p">.</span><span class="nf">loadHistory</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>은 지양하는 것이 좋다.</p>

<p>대신 ViewModel에서</p>

<script src="https://gist.github.com/jjjlyn/a4aba9810a39243d4791d99956590a61.js"></script>

<p>를 사용하자.</p>

<p><strong>Transformation.switchMap</strong>은 <strong>parameter에 들어가는 Livedata value</strong>가 변할 때마다 지속적으로 달라진 상태의 LiveData를 반환한다.
예시코드에서는 <code class="language-plaintext highlighter-rouge">mDate</code>로 선언된 Livedata value값이 변하면 (View 단에서 <code class="language-plaintext highlighter-rouge">mHistoryViewModel.setDate(mDate)</code>로 mDate.value를 바꿈), Transformation.switchMap이 mDate.value의 변화된 값을 감지한 후 우리가 반환하려는 Room DAO에 선언된 <code class="language-plaintext highlighter-rouge">mHistoryDAO.loadHistory()</code>에 mDate.value값을 전달하여 <code class="language-plaintext highlighter-rouge">LiveData&lt;History&gt;</code>를 반환한다.</p>

<script src="https://gist.github.com/jjjlyn/219b45f25050ff6580d7d368b82f3ad2.js"></script>

<p><code class="language-plaintext highlighter-rouge">date</code>는 View에서 선택한 DatePickerDialog의 값에 따라 달라지는 날짜라고 가정해보자. <code class="language-plaintext highlighter-rouge">date</code>를 선택한 후 ViewModel에 선언된 setDate()로 그 값을 넘겨주면 subscribeObservers()내의 loadHistory()가 Callback으로 실행된다.</p>

<script src="https://gist.github.com/jjjlyn/05df4111bfcce4116d1a77ac3e95fd2a.js"></script>

<p>예전에 View에서 ViewModel에 선언된 메소드에 그대로 파라미터를 넘겨주기 위해 View에서</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="kd">var</span> <span class="py">mDate</span> <span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</code></pre></div></div>

<p>로 전역 선언한 후</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mHistoryViewModel</span><span class="p">.</span><span class="nf">loadHistory</span><span class="p">(</span><span class="n">mDate</span><span class="p">)</span>
</code></pre></div></div>

<p>이런 식으로 호출했었는데, mDate에 들어간 값이 항상 불안정하여 원하는 Livedata가 반환되지 않는 상황이 발생한 경험이 있다.
나와 같이 삽질하는 사람들이 없길 바라며… 😂</p>
:ET